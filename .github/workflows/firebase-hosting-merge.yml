# Deploy Firestore indexes on merge (frontend = Vercel, API = Render, Firebase = Auth + Firestore)
name: Deploy Firestore indexes on merge
on:
  push:
    branches:
      - master
jobs:
  deploy_indexes:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Deploy Firestore indexes
        env:
          FIREBASE_SA: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_ZYNC_2018A }}
        run: |
          printf '%s' "$FIREBASE_SA" > "$RUNNER_TEMP/sa.json"
          export GOOGLE_APPLICATION_CREDENTIALS="$RUNNER_TEMP/sa.json"
          npx firebase-tools deploy --only firestore:indexes --project zync-2018a --non-interactive
          rm -f "$RUNNER_TEMP/sa.json"
